version: "3"

services:

  ###LIVE-STREAMING SERVICES###
  #Transcoder: Takes the video from the camera and generates the video chunks and HLS playlists
  transcoder:
    image: heliosh2020/media-transcoder:v2.0
    ports:
      - "1935:1935"
    volumes:
      - cache-content:/opt/data/

  #Cache: Serves the video segments and playlists generated by the transcoder component
  cache:
    image: heliosh2020/media-cache:v2.0
    ports:
      - "800:800"
    volumes:
      - cache-content:/opt/data/

  ###VIDEO CALL SERVICES###
  #Signaling
  signaling:
    container_name: helios-signaling
    image: heliosh2020/media-signaling:v1.0
    ports:
      - "1794:1794"
    volumes:
      - ${CERTS_HOST_PATH}:${CERTS_CONTAINER_PATH}

  coturn:
    container_name: helios-coturn
    image: instrumentisto/coturn
    network_mode: host
    volumes:
      - ${COTURN_CONF_PATH}:${COTURN_CONF_CONTAINER_PATH}
      - ${CERTS_HOST_PATH}:${CERTS_CONTAINER_PATH}

  ###FILE TRANSFER SERVICES###
  #Tus server: enables the resumable uploads
  tus:
    container_name: helios-tus
    image: tusproject/tusd
    entrypoint: "tusd -behind-proxy --hooks-dir /srv/tusd-hooks"
    ports:
      - "1080:1080"
    volumes:
      - tus-content:${TUS_CONTAINER_PATH}


volumes:
  #Volume created to save the video segments and HLS playlists
  cache-content: {}
  #Volume created to store the files uploaded with the tus server
  tus-content: {}

